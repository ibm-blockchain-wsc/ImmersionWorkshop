
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Loopback - Blockchain Immersion Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Blockchain Immersion Workshop" class="md-header-nav__button md-logo" aria-label="Blockchain Immersion Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Blockchain Immersion Workshop
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Loopback
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Blockchain Immersion Workshop" class="md-nav__button md-logo" aria-label="Blockchain Immersion Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Blockchain Immersion Workshop
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      IBM Blockchain Platform v2.5.0 on Linux on IBM Z Lab
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="IBM Blockchain Platform v2.5.0 on Linux on IBM Z Lab" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        IBM Blockchain Platform v2.5.0 on Linux on IBM Z Lab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpconsole/" class="md-nav__link">
      Part 1 - Create a Blockchain Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpdeploy/" class="md-nav__link">
      Part 2 - Deploy Smart Contract
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../references/" class="md-nav__link">
      Additional Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Loopback</h1>
                
                <p>In this section, we are going to create a loopback API application for MagnetoCorp and another loopback API application for Digibank. Once we have created these applications, you'll be able to submit transactions and have them be recorded in our blockchain network. </p>
<p><strong>1.</strong> From the terminal application, open a new tab and navigate to your desktop. Once you are at the desktop, install the loopback npm package. You can find these commands below:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop$ cd ~
tecadmin@ubuntubase:~/Desktop$ npm install -g @loopback/cli
</code></pre>
<p><strong>2.</strong> Once you have the loopback installed, go ahead and follow the series of commands and prompts below. I'll explain these after we have completed this (when you get the <em>Select features to enable in the project</em> prompt, just hit <strong>Enter</strong>):</p>
<pre><code>    ----- Create Our App -----
tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: magnetocorp
? Project description: loopback api for magnetocorp
? Project root directory: magnetocorp
? Application class name: MagnetocorpApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
   create .eslintignore
   create .eslintrc.js
   create .mocharc.json
   create .npmrc
   create .prettierignore
   create .prettierrc
   create DEVELOPING.md
   create README.md
   create index.ts
   create package.json
   create tsconfig.json
   create .vscode/settings.json
   create .vscode/tasks.json
   create .gitignore
   create .dockerignore
   create Dockerfile
   create index.js
   create public/index.html
   create src/application.ts
   create src/index.ts
   create src/migrate.ts
   create src/sequence.ts
   create src/__tests__/README.md
   create src/controllers/README.md
   create src/controllers/index.ts
   create src/controllers/ping.controller.ts
   create src/datasources/README.md
   create src/models/README.md
   create src/repositories/README.md
   create src/__tests__/acceptance/home-page.acceptance.ts
   create src/__tests__/acceptance/ping.controller.acceptance.ts
   create src/__tests__/acceptance/test-helper.ts


Application magnetocorp was created in magnetocorp.

----- Create Model for our Issue -----

tecadmin@ubuntubase:~/Desktop$ cd magnetocorp/
tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 model
? Model class name: issue
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Issue
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: issueDateTime
? Property type: string
? Is issueDateTime the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: maturityDateTime
? Property type: string
? Is maturityDateTime the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: faceValue
? Property type: string
? Is faceValue the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: paperRate
? Property type: string
? Is paperRate the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: 
   create src/models/issue.model.ts
   update src/models/index.ts

Model issue was created in src/models/

----- Create Model for our getPaperRate -----

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 model
? Model class name: getPaperRate
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to GetPaperRate
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: 
   create src/models/get-paper-rate.model.ts
   update src/models/index.ts

Model getPaperRate was created in src/models/

----- Create Model for our getAllPapersFromIssuer -----

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 model
? Model class name: getAllPapersFromIssuer
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to GetAllPapersFromIssuer
Enter an empty property name when done

? Enter the property name: paperIssuer
? Property type: string
? Is paperIssuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetAllPapersFromIssuer
Enter an empty property name when done

? Enter the property name: 
   create src/models/get-all-papers-from-issuer.model.ts
   update src/models/index.ts

Model getAllPapersFromIssuer was created in src/models/

    ----- Create a Datasource -----

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only): 
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/

    ----- Create our Repositories -----

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)GetAllPapersFromIssuer, GetPaperRate, Issue
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for GetAllPapersFromIssuer: id
? Please enter the name of the ID property for GetPaperRate: id
? Please enter the name of the ID property for Issue: id
   create src/repositories/get-all-papers-from-issuer.repository.ts
   create src/repositories/get-paper-rate.repository.ts
   create src/repositories/issue.repository.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
   update src/repositories/index.ts

Repositories GetAllPapersFromIssuerRepository,GetPaperRateRepository,IssueRepository was created in src/repositories/

----- Create a Controller for Issue, GetPaperRate and GetAllPapersFromIssuer -----

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 controller
? Controller class name: Issue
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Issue
? What is the name of your CRUD repository? IssueRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /issues
   create src/controllers/issue.controller.ts
   update src/controllers/index.ts

Controller Issue was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 controller
? Controller class name: GetPaperRate
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? GetPaperRate
? What is the name of your CRUD repository? GetPaperRateRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /get-paper-rates
   create src/controllers/get-paper-rate.controller.ts
   update src/controllers/index.ts

Controller GetPaperRate was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 controller
? Controller class name: GetAllPapersFromIssuer
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? GetAllPapersFromIssuer
? What is the name of your CRUD repository? GetAllPapersFromIssuerRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /get-all-papers-from-issuers
   create src/controllers/get-all-papers-from-issuer.controller.ts
   update src/controllers/index.ts

Controller GetAllPapersFromIssuer was created in src/controllers/
</code></pre>
<p>What you just did above is basically create the bones to our loopback API application. We needed to create our app, model, datasource, repository and controller to actually create our application. Below is a breakdown of each thing we created. </p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Do not repeat the commands shown in the rest of this section as they are snippets of what you just entered above and they are repeated here for illustrative purposes</p>
</div>
<p><strong>App:</strong></p>
<p>The LoopBack 4 CLI toolkit comes with templates that generate whole applications, as well as artifacts (for example, controllers, models, and repositories) for existing applications.</p>
<pre><code>tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: magnetocorp
? Project description: loopback application for magnetocorp
? Project root directory: magnetocorp
? Application class name: MagnetoCorpApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable --- Press enter to enable all of these! ---
prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
</code></pre>
<p><strong>Model:</strong></p>
<p>Now we can begin working on the representation of our data for use with LoopBack 4, which needs to align with what is in our smart conract. To that end, we’re going to create an issue and buy model that can represent instances of a task for our papercontract. A model describes business domain objects and defines a list of properties with name, type, and other constraints. Models are used for data exchange on the wire or between different systems. </p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 model
? Model class name: getPaperRate
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to GetPaperRate
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: 
   create src/models/get-paper-rate.model.ts
   update src/models/index.ts

Model getPaperRate was created in src/models/
</code></pre>
<p><strong>Datasource:</strong></p>
<p>Datasources are LoopBack’s way of connecting to various sources of data, such as databases, APIs, message queues and more. In LoopBack 4, datasources can be represented as strongly-typed objects and freely made available for injection throughout the application. Typically, in LoopBack 4, datasources are used in conjunction with Repositories to provide access to data.</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only):
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/
</code></pre>
<p><strong>Repositories:</strong></p>
<p>A Repository represents a specialized Service interface that provides strong-typed data access (for example, CRUD) operations of a domain model against the underlying database or service.</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)GetAllPapersFromIssuer, GetPaperRate, Issue
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for GetAllPapersFromIssuer: id
? Please enter the name of the ID property for GetPaperRate: id
? Please enter the name of the ID property for Issue: id
   create src/repositories/get-all-papers-from-issuer.repository.ts
   create src/repositories/get-paper-rate.repository.ts
   create src/repositories/issue.repository.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
</code></pre>
<p><strong>Controller:</strong></p>
<p>In LoopBack 4, controllers handle the request-response lifecycle for your API. Each function on a controller can be addressed individually to handle an incoming request (like a POST request to /todos), to perform business logic, and to return a response.</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ lb4 controller
? Controller class name: Issue
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Issue
? What is the name of your CRUD repository? IssueRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /issues
   create src/controllers/issue.controller.ts
   update src/controllers/index.ts

Controller Issue was created in src/controllers/
</code></pre>
<p>You can find out more information and great tutorials as to how to build your own loopback API application here: https://loopback.io/doc/en/lb4/index.html</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Okay, now resume entering or performing any commands or tasks you see.</p>
</div>
<p><strong>3.</strong> Within VSCode, go to the <code>Explorer Perspective</code> and do <code>File -&gt; Add Folder to Workplace</code> and navigate to the <code>magnetocorp</code> folder that we just created within the <code>Desktop</code> folder. Go ahead and open that folder in VSCode.</p>
<p><strong>4.</strong> Now within VSCode, right click on <code>magnetocorp</code> - the folder you just opened in VSCode. Once you right click, select <code>New Folder</code> and name it <code>data</code>. Really mysterious right? </p>
<p><strong>5.</strong> On the newly created folder, <code>data</code>, right click on that folder and select <code>New File</code> and name that file <code>db.json</code>. Within that new file, add in this text below
::</p>
<pre><code>{
  "ids": {
    "Todo": 5
  },
  "models": {
    "Todo": {
      "1": "{\"title\":\"Take over the galaxy\",\"desc\":\"MWAHAHAHAHAHAHAHAHAHAHAHAHAMWAHAHAHAHAHAHAHAHAHAHAHAHA\",\"id\":1}",
      "2": "{\"title\":\"destroy alderaan\",\"desc\":\"Make sure there are no survivors left!\",\"id\":2}",
      "3": "{\"title\":\"terrorize senate\",\"desc\":\"Tell them they're getting a budget cut.\",\"id\":3}",
      "4": "{\"title\":\"crush rebel scum\",\"desc\":\"Every.Last.One.\",\"id\":4}"
    }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> This file, db.json, contains an example database.</p>
<p><strong>6.</strong> Within the <code>magnetocorp</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>magnetocorp -&gt; src -&gt; repositories
</code></pre>
<p>You should see 5 files in there: <code>README.md</code>, <code>issue.repository.ts</code>, <code>get-paper-rate.repository.ts</code>, <code>get-all-papers-from-issuer.repository.ts</code>, and <code>index.ts</code></p>
<p><strong>7.</strong> Within the <code>issue.repository.ts</code> file, add <code>//</code> on line 8. Look below as to what to do
::</p>
<pre><code>typeof Issue.prototype.id

--- CHANGE TO ---

// typeof Issue.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>8.</strong> Do the same thing for <code>get-paper-rate.repository.ts</code> on line 8
::</p>
<pre><code>typeof GetPaperRate.prototype.id

--- CHANGE TO ---

// typeof GetPaperRate.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>9.</strong> Do the same thing for <code>get-all-papers-from-issuer.repository.ts</code> on line 8
::</p>
<pre><code>typeof GetAllPapersFromIssuer.prototype.id

--- CHANGE TO ---

// typeof GetAllPapersFromIssuer.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>10.</strong> Within the <code>magnetocorp</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>magnetocorp -&gt; src -&gt; controllers
</code></pre>
<p>You should see 6 files in there: <code>README.md</code>, <code>issue.controller.ts</code>, <code>get-paper-rate.controller.ts</code>, <code>get-all-papers-from-issuer.controller.ts</code>, <code>ping.controller.ts</code>, and <code>index.ts</code></p>
<p><strong>11.</strong> Within the <code>issue.controller.ts</code> file, delete all of its contents and paste in what is below
::</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Issue } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class IssueController {
  constructor() { }

  @post('/issue', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Issue } } },
      },
    },
  })
 async createIssue(@requestBody() requestBody: Issue): Promise&lt;Issue&gt; {
   console.log('Buy, requestBody: ')
    console.log(requestBody)


    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
     let errString = 'Error connecting to network';
      let issue = new Issue({ issuer: errString, paperNumber: errString, issueDateTime: errString, maturityDateTime: errString, faceValue: errString, paperRate: errString });
      return issue;
    }
    console.log('newtork obj: ')
    console.log(networkObj)

    let dataForIssue = {
      function: 'issue',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      issueDateTime: requestBody.issueDateTime,
      maturityDateTime: requestBody.maturityDateTime,
      faceValue: requestBody.faceValue,
      paperRate: requestBody.paperRate,
      contract: networkObj.contract
    };

    var resultAsBuffer = await blockchainClient.issue(dataForIssue);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    console.log('result from blockchainClient.submitTransaction in controller: ')
    let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
    let issue = new Issue({
      issuer: result.issuer, paperNumber: result.paperNumber, issueDateTime: result.issueDateTime,
      maturityDateTime: result.maturityDateTime, faceValue: result.faceValue, paperRate: result.paperRate
    });
    return issue;
  }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p>Below is a breakdown of this file above:</p>
<p>Below, we are pulling in the <code>issue</code> model that we created when we created our loopback API application:</p>
<pre><code>import { Issue } from '../models';
</code></pre>
<p>Below, we are only specifying a <code>post</code> API call. A post call adds data, in this case a transaction against our blockchain network, to our ledgers:</p>
<pre><code>@post('/issue', {
    responses: {
      '200': {
</code></pre>
<p>Below, we are actually submitting a transaction, an <code>issue</code> transaction. This transaction is looking for all the data fields we created in our <code>issue</code> model file. If all goes well, we will successfully <code>issue</code> a commercialpaper: </p>
<pre><code> async createIssue(@requestBody() requestBody: Issue): Promise&lt;Issue&gt; {
   console.log('Buy, requestBody: ')
    console.log(requestBody)

    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
     let errString = 'Error connecting to network';
      let issue = new Issue({ issuer: errString, paperNumber: errString, issueDateTime: errString, maturityDateTime: errString, faceValue: errString, paperRate: errString });
      return issue;
    }
</code></pre>
<p><strong>12.</strong> Within VSCode, right click on the <code>src</code> folder (within the <code>magnetocorp</code> folder) and select <code>New File</code>. Go ahead and name this file <code>blockchainClient.ts</code></p>
<p><strong>13.</strong> Within our new <code>blockchainClient.ts</code> file, paste in this code below:</p>
<pre><code>import { json } from "body-parser";

const yaml = require('js-yaml');
const { FileSystemWallet, Gateway } = require('fabric-network');
const fs = require('fs');

// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/.fabric-vscode/local_fabric_wallet');


export module BlockChainModule {

  export class BlockchainClient {
   async connectToNetwork() {

      const gateway = new Gateway();

      try {
        console.log('connecting to Fabric network...')


        const identityLabel = 'isabella';
       let connectionProfile = yaml.safeLoad(fs.readFileSync('/home/tecadmin/Desktop/magnetocorp/networkConnection.yaml', 'utf8'));

       let connectionOptions = {
         identity: identityLabel,
         wallet: wallet,
         discovery: {
           asLocalhost: true,
           enabled: true
         }
       };

      // Connect to gateway using network.yaml file and our certificates in _idwallet directory
      await gateway.connect(connectionProfile, connectionOptions);

    console.log('Connected to Fabric gateway.');

    // Connect to our local fabric
    const network = await gateway.getNetwork('mychannel');

    console.log('Connected to mychannel. ');

    // Get the contract we have installed on the peer
    const contract = await network.getContract('papercontract');


    let networkObj = {
      contract: contract,
      network: network
    };

    return networkObj;

  } catch (error) {
    console.log(`Error processing transaction. ${error}`);
    console.log(error.stack);
  } finally {
    console.log('Done connecting to network.');
    // gateway.disconnect();
  }

}




   async issue(args: any) {

     console.log('args for issue: ')
     console.log(args)

     let response = await args.contract.submitTransaction(args.function,
       args.issuer, args.paperNumber, args.issueDateTime, args.maturityDateTime,
       args.faceValue, args.paperRate
     );

     return response;

   }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> Below is a breakdown of our <code>blockchainClient.ts</code> file:</p>
<p>Below, you'll see that we are specifying where our user's credientials are located to validate that our user can actually submit a transaction:</p>
<pre><code>// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/Desktop/magnetocorp/local_fabric_wallet');
</code></pre>
<p>Below, we are saying that within the <code>.fabric-vscode/local_fabric_wallet</code> folder we are using <code>User1@org1.example.com</code> as our user. Also, we are saying that our connection profile is <code>networkConnection.yaml</code> located one directory back. We will copy the connection profile in the next section:</p>
<pre><code>const identityLabel = 'isabella';
let connectionProfile = yaml.safeLoad(fs.readFileSync('/home/tecadmin/Desktop/magnetocorp/networkConnection.yaml', 'utf8'));
</code></pre>
<p>Below, we are connecting to our channel, called <code>mychannel</code>, and also using our smart contract, called <code>papercontract</code>:</p>
<pre><code>// Connect to our local fabric
const network = await gateway.getNetwork('mychannel');

console.log('Connected to mychannel. ');

// Get the contract we have installed on the peer
const contract = await network.getContract('papercontract');
</code></pre>
<p>Below, we are actually submitting our <code>issue</code> transaction. There is a very similar transaction. This will use our <code>issue</code> controller as a basis for our actual arguments (args): </p>
<pre><code>   async issue(args: any) {

     console.log('args for issue: ')
     console.log(args)

     let response = await args.contract.submitTransaction(args.function,
       args.issuer, args.paperNumber, args.issueDateTime, args.maturityDateTime,
       args.faceValue, args.paperRate
     );

     return response;

   }
</code></pre>
<p><strong>14.</strong> Now, we need to copy our <code>networkConnection.yaml</code> file over from <code>magnetocorp</code> in our <code>fabric-samples-cp</code> folder and place it into our <code>magnetocorp</code> folder. You can execute the command below, from our terminal application, as to how to copy:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ cp /home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/magnetocorp/gateway/networkConnection.yaml .
#
</code></pre>
<p><strong>15.</strong> From VSCode, go to the IBM Blockchain Platform Extension and right click on <code>local_fabric_wallet</code> and select <code>Add Identity to Wallet</code>. From there follow the prompt as it follows below:</p>
<pre><code>Provide a Name for the Identity:
    isabella
Enter MSPID:
    Org1MSP
Choose a method of adding an identity:
    Provide an enrollment ID and secret
Enter Enrollment ID:
    admin
Enter Enrollment secret:
    adminpw
</code></pre>
<p><strong>16.</strong> We need to modify our <code>package.json</code> file to include the <code>fabric-network</code> module. Within our <code>magnetocorp</code> folder, find the <code>package.json</code> file and add in the following text below on <code>line 58</code>:</p>
<pre><code>"fabric-network": "~1.4.1"
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note<p>Your line number may differ- the important thing is that this line is added to the end of the <em>dependencies</em> section, and not in the <em>dev-dependencies</em> section.</p>
</p>
</div>
<p>So now our <code>dependencies</code> look like this:</p>
<pre><code>"dependencies": {
    "@loopback/boot": "^1.4.0",
    "@loopback/context": "^1.19.0",
    "@loopback/core": "^1.8.1",
    "@loopback/openapi-v3": "^1.6.1",
    "@loopback/repository": "^1.6.1",
    "@loopback/rest": "^1.15.0",
    "@loopback/rest-explorer": "^1.2.1",
    "@loopback/service-proxy": "^1.2.1",
    "fabric-network": "~1.4.1"
</code></pre>
<p><strong>Do not forget to add a comma after the "@loopback/service-proxy": "^1.2.1" dependency above the line you just added.</strong></p>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>17.</strong> Now we can delete the <code>node_modules</code> and <code>package-lock.json</code> file so that it will pick up the <code>fabric-network</code> package when we do an npm install again. To do this, within VSCode, right click on <code>node_modules</code> and select <code>Delete</code>. Do the same for <code>package-lock.json</code>. If it asks you to confirm this, select <code>Move to Trash</code>.</p>
<p><strong>18.</strong> Back in our terminal application, do an <code>npm install</code> within the <code>magnetocorp</code> folder:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ npm install
*
*
*
added 748 packages from 1578 contributors and audited 4980 packages in 45.757s
found 3 vulnerabilities (1 low, 2 moderate)
</code></pre>
<p><strong>19.</strong> Then you can do an <code>npm build</code> as well from the same folder:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ npm run build

&gt; magnetocorp@1.0.0 build /home/tecadmin/Desktop/magnetocorp
&gt; lb-tsc es2017 --outDir dist
</code></pre>
<p><strong>20.</strong> We will hold off on starting the server until we have built the DigiBank loopback application as well. </p>
<p><strong>21.</strong> Speaking of DigiBank, let's build their loopback API application. It will be very similar to how we built MagnetoCorp's. </p>
<p><strong>22.</strong> Go ahead and follow the series of commands and prompts below to create Digibank's loopback application. I'll explain these after we have completed this:</p>
<pre><code>----- Create Our App -----

tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: digibank
? Project description: loopback api for digibank
? Project root directory: digibank
? Application class name: DigibankApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
   create .eslintignore
   create .eslintrc.js
   create .mocharc.json
   create .npmrc
   create .prettierignore
   create .prettierrc
   create DEVELOPING.md
   create README.md
   create index.ts
   create package.json
   create tsconfig.json
   create .vscode/settings.json
   create .vscode/tasks.json
   create .gitignore
   create .dockerignore
   create Dockerfile
   create index.js
   create public/index.html
   create src/application.ts
   create src/index.ts
   create src/migrate.ts
   create src/sequence.ts
   create src/__tests__/README.md
   create src/controllers/README.md
   create src/controllers/index.ts
   create src/controllers/ping.controller.ts
   create src/datasources/README.md
   create src/models/README.md
   create src/repositories/README.md
   create src/__tests__/acceptance/home-page.acceptance.ts
   create src/__tests__/acceptance/ping.controller.acceptance.ts
   create src/__tests__/acceptance/test-helper.ts


Application digibank was created in digibank.


----- Create Model for our Buy -----

tecadmin@ubuntubase:~/Desktop$ cd digibank/
tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: buy
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Buy
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: currentOwner
? Property type: string
? Is currentOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: newOwner
? Property type: string
? Is newOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: price
? Property type: string
? Is price the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: purchaseDateTime
? Property type: string
? Is purchaseDateTime the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: 
   create src/models/buy.model.ts
   update src/models/index.ts

Model buy was created in src/models/

----- Create Model for our Redeem -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: redeem
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Redeem
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: redeemingOwner
? Property type: string
? Is redeemingOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: redeemDateTime
? Property type: string
? Is redeemingOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: 
   create src/models/redeem.model.ts
   update src/models/index.ts

Model redeem was created in src/models/

----- Create Model for our getPaperRate -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: getPaperRate
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to GetPaperRate
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetPaperRate
Enter an empty property name when done

? Enter the property name: 
   create src/models/get-paper-rate.model.ts
   update src/models/index.ts

Model getPaperRate was created in src/models/

----- Create Model for our getAllPapersFromIssuer -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: getAllPapersFromIssuer
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to GetAllPapersFromIssuer
Enter an empty property name when done

? Enter the property name: paperIssuer
? Property type: string
? Is paperIssuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to GetAllPapersFromIssuer
Enter an empty property name when done

? Enter the property name: 
   create src/models/get-all-papers-from-issuer.model.ts
   update src/models/index.ts

Model getAllPapersFromIssuer was created in src/models/

    ----- Create a Datasource -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only): 
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/

    ----- Create a Repository -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Buy, GetAllPapersFromIssuer, GetPaperRate, Redeem
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for Buy: id
? Please enter the name of the ID property for GetAllPapersFromIssuer: id
? Please enter the name of the ID property for GetPaperRate: id
? Please enter the name of the ID property for Redeem: id
   create src/repositories/buy.repository.ts
   create src/repositories/get-all-papers-from-issuer.repository.ts
   create src/repositories/get-paper-rate.repository.ts
   create src/repositories/redeem.repository.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
   update src/repositories/index.ts

Repositories BuyRepository,GetAllPapersFromIssuerRepository,GetPaperRateRepository,RedeemRepository was created in src/repositories/

----- Create a Controller for the Issue Transaction -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Buy
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Buy
? What is the name of your CRUD repository? BuyRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /buys
   create src/controllers/buy.controller.ts
   update src/controllers/index.ts

Controller Buy was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Redeem
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Redeem
? What is the name of your CRUD repository? RedeemRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /redeems
   create src/controllers/redeem.controller.ts
   update src/controllers/index.ts

Controller Redeem was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: GetPaperRate
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? GetPaperRate
? What is the name of your CRUD repository? GetPaperRateRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /get-paper-rates
   create src/controllers/get-paper-rate.controller.ts
   update src/controllers/index.ts

Controller GetPaperRate was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: GetAllPapersFromIssuer
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? GetAllPapersFromIssuer
? What is the name of your CRUD repository? GetAllPapersFromIssuerRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /get-all-papers-from-issuers
   create src/controllers/get-all-papers-from-issuer.controller.ts
   update src/controllers/index.ts

Controller GetAllPapersFromIssuer was created in src/controllers/
</code></pre>
<p>You just did the same thing for DigiBank, as you earlier did for MagnetoCorp and their loopback API application. </p>
<p><strong>23.</strong> Within VSCode, go to the <code>Explorer Perspective</code> and do <code>File -&gt; Add Folder to Workplace</code> and navigate to the <code>digibank</code> folder that we just created within the <code>Desktop</code> folder. Go ahead and open that folder in VSCode.</p>
<p><strong>24.</strong> Now within VSCode, right click on <code>digibank</code> - the folder you just opened in VSCode. Once you right click, select <code>New Folder</code> and name it <code>data</code>. Really mysterious right? </p>
<p><strong>25.</strong> On the newly created folder, <code>data</code>, right click on that folder and select <code>New File</code> and name that file <code>db.json</code>. Within that new file, add in this text below:</p>
<pre><code>{
  "ids": {
    "Todo": 5
  },
  "models": {
    "Todo": {
      "1": "{\"title\":\"Take over the galaxy\",\"desc\":\"MWAHAHAHAHAHAHAHAHAHAHAHAHAMWAHAHAHAHAHAHAHAHAHAHAHAHA\",\"id\":1}",
      "2": "{\"title\":\"destroy alderaan\",\"desc\":\"Make sure there are no survivors left!\",\"id\":2}",
      "3": "{\"title\":\"terrorize senate\",\"desc\":\"Tell them they're getting a budget cut.\",\"id\":3}",
      "4": "{\"title\":\"crush rebel scum\",\"desc\":\"Every.Last.One.\",\"id\":4}"
    }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> This file, db.json, contains an example database.</p>
<p><strong>26.</strong> Within the <code>digibank</code> folder in VSCode, navigate to the following folder:</p>
<pre><code>digibank -&gt; src -&gt; repositories
</code></pre>
<p>You should see 6 files in there: <code>README.md</code>, <code>buy.repository.ts</code>, <code>redeem.repository.ts</code>, <code>get-paper-rate.repository.ts</code>, <code>get-all-papers-from-issuer.repository.ts</code> and <code>index.ts</code></p>
<p><strong>27.</strong> Within the <code>buy.repository.ts</code> file, add <code>//</code> on line 8. Look below as to what to do:</p>
<pre><code>typeof Buy.prototype.id

--- CHANGE TO ---

// typeof Buy.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>28.</strong> Within the <code>Redeem.repository.ts</code> file, add <code>//</code> on line 8. Look below as to what to do:</p>
<pre><code>typeof Redeem.prototype.id

--- CHANGE TO ---

// typeof Redeem.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>29.</strong> Within the <code>get-paper-rate.repository.ts</code> file, add <code>//</code> on line 8. Look below as to what to do:</p>
<pre><code>typeof GetPaperRate.prototype.id

--- CHANGE TO ---

// typeof GetPaperRate.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>30.</strong> Within the <code>get-all-papers-from-issuer.repository.ts</code> file, add <code>//</code> on line 8. Look below as to what to do:</p>
<pre><code>typeof GetAllPapersFromIssuer.prototype.id

--- CHANGE TO ---

// typeof GetAllPapersFromIssuer.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>31.</strong> Within the <code>digibank</code> folder in VSCode, navigate to the following folder:</p>
<pre><code>digibank -&gt; src -&gt; controllers
</code></pre>
<p>You should see 7 files in there: <code>README.md</code>, <code>buy.controller.ts</code>, <code>redeem.controller.ts</code>, <code>get-paper-rate.controller.ts</code>, <code>get-papers-from-issuer.controller.ts</code>, <code>ping.controller.ts</code>, and <code>index.ts</code></p>
<p><strong>32.</strong> Within the <code>buy.controller.ts</code> file, delete all of its contents and paste in the code that is below:</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Buy } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class BuyController {
  constructor() { }

  @post('/buy', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Buy } } },
      },
    },
  })
  async createBuy(@requestBody() requestBody: Buy): Promise&lt;Buy&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)
    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
     let errString = 'Error connecting to network';
      let buy = new Buy({
      issuer: errString, paperNumber: errString, currentOwner: errString, newOwner: errString,
      price: errString, purchaseDateTime: errString
     });
     return buy;
    }
    console.log('newtork obj: ')
    console.log(networkObj)
    // dateStr = dateStr.toDateString();
    let dataForBuy = {
      function: 'buy',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      currentOwner: requestBody.currentOwner,
      newOwner: requestBody.newOwner,
      price: requestBody.price,
      purchaseDateTime: requestBody.purchaseDateTime,
      contract: networkObj.contract
    };

   var resultAsBuffer = await blockchainClient.buy(dataForBuy);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
    let buy = new Buy({
      issuer: result.issuer, paperNumber: result.paperNumber, currentOwner: result.currentOwner,
      newOwner: result.currentOwner, price: result.price, purchaseDateTime: result.purchaseDateTime
    });
    return buy;
  }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>33.</strong> Within the <code>redeem.controller.ts</code> file, delete all of its contents and paste in the code that is below:</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Redeem } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class RedeemController {
  constructor() { }

  @post('/redeem', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Redeem } } },
      },
    },
  })
  async createIssue(@requestBody() requestBody: Redeem): Promise&lt;Redeem&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)

    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let redeem = new Redeem({
        issuer: errString, paperNumber: errString, redeemingOwner: errString,
        redeemDateTime: errString
          });
      return redeem;
    }
    console.log('newtork obj: ')
    console.log(networkObj)

    let dataForRedeem = {
      function: 'redeem',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      redeemingOwner: requestBody.redeemingOwner,
      redeemDateTime: requestBody.redeemDateTime,
      contract: networkObj.contract
    };

    var resultAsBuffer = await blockchainClient.redeem(dataForRedeem);

   console.log('result from blockchainClient.submitTransaction in controller: ')
   let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
   let issue = new Redeem({
      issuer: result.issuer, paperNumber: result.paperNumber, redeemingOwner: result.redeemingOwner,
      redeemDateTime: result.redeemDateTime
    });
    return issue;
  }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>34.</strong> Within VSCode, right click on the <code>src</code> folder (within the <code>digibank</code> folder) and select <code>New File</code>. Go ahead and name this file <code>blockchainClient.ts</code></p>
<p><strong>35.</strong> Within our new <code>blockchainClient.ts</code> file, paste in this code below:</p>
<pre><code>const yaml = require('js-yaml');
const { FileSystemWallet, Gateway } = require('fabric-network');
const fs = require('fs');

// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/.fabric-vscode/local_fabric_wallet');


export module BlockChainModule {

  export class BlockchainClient {
    async connectToNetwork() {

      const gateway = new Gateway();

      try {
        console.log('connecting to Fabric network...')


        const identityLabel = 'balaji';
        let connectionProfile = yaml.safeLoad(fs.readFileSync('/home/tecadmin/Desktop/digibank/networkConnection.yaml', 'utf8'));

        let connectionOptions = {
          identity: identityLabel,
          wallet: wallet,
          discovery: {
            asLocalhost: true,
            enabled: true
          }
        };

        // Connect to gateway using network.yaml file and our certificates in _idwallet directory
        await gateway.connect(connectionProfile, connectionOptions);

        console.log('Connected to Fabric gateway.');

        // Connect to our local fabric
        const network = await gateway.getNetwork('mychannel');

        console.log('Connected to mychannel. ');

        // Get the contract we have installed on the peer
        const contract = await network.getContract('papercontract');


        let networkObj = {
          contract: contract,
          network: network
        };

        return networkObj;

      } catch (error) {
        console.log(`Error processing transaction. ${error}`);
        console.log(error.stack);
      } finally {
        console.log('Done connecting to network.');
        // gateway.disconnect();
      }

    }

    async redeem(args: any) {

      console.log('args for redeem: ')
      console.log(args)

      let response = await args.contract.submitTransaction(args.function,
        args.issuer, args.paperNumber, args.redeemingOwner, args.redeemDateTime
      );

      return response;
    }


    async buy(args: any) {

      console.log('args for buy: ')
      console.log(args)

      let response = await args.contract.submitTransaction(args.function,
        args.issuer, args.paperNumber, args.currentOwner, args.newOwner,
        args.price, args.purchaseDateTime
      );

      return response;

    }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>36.</strong> Now, we need to copy our <code>networkConnection.yaml</code> file over from <code>digibank</code> in our <code>fabric-samples-cp</code> folder and place it into our <code>digibank</code> folder. You can execute the command below, from our terminal application, as to how to copy:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ cp /home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/gateway/networkConnection.yaml .
#
</code></pre>
<p><strong>37.</strong> From VSCode, go to the IBM Blockchain Platform Extension and right click on <code>local_fabric_wallet</code> and select <code>Add Identity to Wallet</code>. From there follow the prompt as it follows below:</p>
<pre><code>Provide a Name for the Identity:
    balaji
Enter MSPID:
    Org1MSP
Choose a method of adding an identity:
    Provide an enrollment ID and secret
Enter Enrollment ID:
    admin
Enter Enrollment secret:
    adminpw
</code></pre>
<p><strong>38.</strong> Within our <code>digibank</code> folder in VSCode, find the <code>index.js</code> file. In here there is a port number we need to change. Since <code>magnetocorp</code> is occupying port <code>3000</code>, we should make <code>digibank</code> occupy port <code>3001</code>. You can find the port number within the <code>index.js</code> file on line 9. Look below at to what to do:</p>
<pre><code>port: +process.env.PORT || 3000,

--- CHANGE TO ---

port: +process.env.PORT || 3001,
</code></pre>
<p><strong>39.</strong> We need to modify our <code>package.json</code> file to include the <code>fabric-network</code> module. Within our <code>digibank</code> folder, find the <code>package.json</code> file and add in the following text below on <code>line 58</code>:</p>
<pre><code>"fabric-network": "~1.4.1"
</code></pre>
<p>So now our <code>dependencies</code> look like this:</p>
<pre><code>  "dependencies": {
    "@loopback/boot": "^1.4.0",
    "@loopback/context": "^1.19.0",
    "@loopback/core": "^1.8.1",
    "@loopback/openapi-v3": "^1.6.1",
    "@loopback/repository": "^1.6.1",
    "@loopback/rest": "^1.15.0",
    "@loopback/rest-explorer": "^1.2.1",
    "@loopback/service-proxy": "^1.2.1",
    "fabric-network": "~1.4.1"
</code></pre>
<p><strong>Do not forget to add a comma after the "@loopback/service-proxy": "^1.2.1" dependency</strong></p>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>40.</strong> Now we can delete the <code>node_modules</code> and <code>package-lock.json</code> file so that it will pick up the <code>fabric-network</code> package when we do an npm install again. To do this, within VSCode, right click on <code>node_modules</code> and select <code>Delete</code>. Do the same for <code>node_modules</code>. If it asks you to confirm this, select <code>Move to Trash</code>.</p>
<p><strong>41.</strong> Back in our terminal application, do an <code>npm install</code> within the <code>digibank</code> folder:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm install
*
*
*
added 748 packages from 1578 contributors and audited 4980 packages in 45.757s
found 3 vulnerabilities (1 low, 2 moderate)
</code></pre>
<p><strong>42.</strong> Then you can do an <code>npm build</code> as well from the same folder:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm run build

&gt; magnetocorp-commercialpaper@1.0.0 build /home/tecadmin/Desktop/digibank
&gt; lb-tsc es2017 --outDir dist
</code></pre>
<p><strong>43.</strong> Now, we can start both loopback applications. Let's first go start MagnetoCorp's. To do this, go to your terminal application - where you generated the <code>magnetocorp</code> folder. Then run the command below:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp$ npm start

&gt; magnetocorp@1.0.0 prestart /home/tecadmin/Desktop/magnetocorp
&gt; npm run build


&gt; magnetocorp@1.0.0 build /home/tecadmin/Desktop/magnetocorp
&gt; lb-tsc es2017 --outDir dist


&gt; magnetocorp@1.0.0 start /home/tecadmin/Desktop/magnetocorp
&gt; node .

Server is running at http://[::1]:3000
Try http://[::1]:3000/ping
</code></pre>
<p><strong>44.</strong> Then go to your <code>digibank</code> terminal application and do the same command:</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm start

&gt; digibank@1.0.0 prestart /home/tecadmin/Desktop/digibank
&gt; npm run build


&gt; digibank@1.0.0 build /home/tecadmin/Desktop/digibank
&gt; lb-tsc es2017 --outDir dist


&gt; digibank@1.0.0 start /home/tecadmin/Desktop/digibank
&gt; node .

Server is running at http://[::1]:3001
Try http://[::1]:3001/ping
</code></pre>
<p><strong>45.</strong> Go to <code>MagnetoCorp's</code> loopback application by going to <code>http://[::1]:3000</code></p>
<p><img alt="image" src="../vscode-images/2-6-39.png" /></p>
<p><strong>46.</strong> Do the same, but this time for DigiBank. You can go to <code>http://[::1]:3001</code>. It should look the same as MagnetoCorp, but says <code>DigiBank's</code> instead. </p>
<p><strong>47.</strong> You can move forward <strong>with both loopback applications</strong> by clicking on the <code>/explorer</code> link toward the bottom</p>
<p><strong>48.</strong> Within the <code>MagnetoCorp</code> loopback UI (<code>port 3000</code>), go ahead and toggle on the <code>Issue</code> controller. Then click on <code>Try it Out</code>.</p>
<p><img alt="image" src="../vscode-images/2-6-42.png" /></p>
<p><strong>49.</strong> Then paste in the code below to issue a new paper in the white space:</p>
<pre><code>{
  "issuer": "MagnetoCorp",
  "paperNumber": "00005",
  "issueDateTime": "2020-05-31",
  "maturityDateTime": "2020-11-30",
  "faceValue": "5000000",
  "paperRate": "0.02"
}
</code></pre>
<p><strong>50.</strong> Once you have the new paper in there, go ahead and click on the blue <code>Execute</code> button below</p>
<p><strong>51.</strong> Then you will see the output of our <code>issue</code> transaction</p>
<p><img alt="image" src="../vscode-images/2-6-45.png" /></p>
<p>Don't be alarm by the the <code>faceValue</code> and <code>paperRate</code> not appearing in our response. We will confirm that it actually went through here in a second.</p>
<p><strong>52.</strong> From the IBM Blockchain Platform Extension in VSCode, connect to the <code>local_fabric</code> Fabric Gateway and select <code>balaji</code> as your identity to connect with (it will pop up in the top middle). Then untoggle till you see the <code>buy</code> transaction under our <code>papercontract@0.0.2</code> smart contract. Enter the code below - between the brackets - to submit this transaction:</p>
<pre><code>"MagnetoCorp", "00005", "MagnetoCorp", "DigiBank", "4900000", "2019-07-31"
</code></pre>
<p>You should see a success message below in the bottom right</p>
<p><strong>53.</strong> From same Fabric Gateway, right click on <code>getAllPapersFromIssuer</code> and select <code>Evaluate Transaction</code>. Enter the code below - between the brackets - to submit the query:</p>
<pre><code>"MagnetoCorp"
</code></pre>
<p>You should see all of the MagnetoCorp issued papers. Notice, how our paper #00005 has a new owner, <code>DigiBank</code>. </p>
<p><img alt="image" src="../vscode-images/2-6-53.png" /></p>
<p><strong>54.</strong> Now, let's go to our <code>DigiBank</code> loopback application (port: <code>3001</code>) and do a <code>redeem</code> transaction. To do this, untoggle the <code>Redeem</code> controller and click on <code>Try it out</code></p>
<p><strong>55.</strong> Then paste in what is below in the white space:</p>
<pre><code>{
  "issuer": "MagnetoCorp",
  "paperNumber": "00005",
  "redeemingOwner": "DigiBank",
  "redeemDateTime": "2020-11-30"
}
</code></pre>
<p><strong>56.</strong> Once you have that in place, go ahead and click on the blue <code>Execute</code> button. </p>
<p>Feel free to submit transactions some more through the loopback applications and VSCode. Once you are done, go ahead and clean up the lab station so we can have more fun the labs coming up.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>