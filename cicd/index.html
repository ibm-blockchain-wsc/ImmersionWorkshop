



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Part 3 - CICD - Blockchain Immersion Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Blockchain Immersion Workshop" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Blockchain Immersion Workshop
            </span>
            <span class="md-header-nav__topic">
              
                Part 3 - CICD
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Blockchain Immersion Workshop" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Blockchain Immersion Workshop
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Use Case Walkthrough
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Use Case Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../immunichain-home/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../immunichain/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      VSCode Lab
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        VSCode Lab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../vscode-home/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vscode-part1/" title="Part 1 - Create Smart Contract" class="md-nav__link">
      Part 1 - Create Smart Contract
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vscode-part2/" title="Part 2 - Commercial Paper" class="md-nav__link">
      Part 2 - Commercial Paper
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xchaincode/" title="Part 3 - Cross Chaincode and Debug" class="md-nav__link">
      Part 3 - Cross Chaincode and Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../loopback/" title="Part 4 - Create Loopback API" class="md-nav__link">
      Part 4 - Create Loopback API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      IBM Blockchain Platform for Multicloud on Linux on Z Lab
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        IBM Blockchain Platform for Multicloud on Linux on Z Lab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpconsole/" title="Part 1 - Create a Blockchain Network" class="md-nav__link">
      Part 1 - Create a Blockchain Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpdeploy/" title="Part 2 - Deploy Smart Contract" class="md-nav__link">
      Part 2 - Deploy Smart Contract
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
    <a href="./" title="Part 3 - CICD" class="md-nav__link md-nav__link--active">
      Part 3 - CICD
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../references/" title="Additional Resources" class="md-nav__link">
      Additional Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Part 3 - CICD</h1>
                
                <p><strong>1.</strong> Go to <code>https://github.com/austingrice/digibank</code> within Firefox</p>
<p><strong>2.</strong> Then click on <code>Fork</code> button in the top right. Then log into your
GitHub or create a Github account to then fork this repository</p>
<p><strong>3.</strong> Once you have the forked repository in your GitHub account, then
you can do a <code>Git Clone</code>. To do this find the <code>Clone or download</code> button
on the right and then click on the copy button to the right of the URL</p>
<p><img alt="image" src="../cicdimages/forkgithub.png" /></p>
<p><strong>4.</strong> Then go to your terminal and navigate to your <code>Desktop</code> folder.
Once you are there, enter the command below :</p>
<pre><code>tecadmin@ubuntubase:~/Desktop$ cd ~
tecadmin@ubuntubase:~/Desktop$ git clone https://github.com/austingrice/digibank.git
Cloning into 'digibank'...
remote: Enumerating objects: 56, done.
remote: Counting objects: 100% (56/56), done.
remote: Compressing objects: 100% (43/43), done.
remote: Total 56 (delta 6), reused 53 (delta 6), pack-reused 0
Unpacking objects: 100% (56/56), done.
</code></pre>
<p><strong>5.</strong> While you are in the terminal, navigate to the folder where you
downloaded your <code>connection profile</code> from Part 2, Section 8 and step 2.
:</p>
<pre><code>For example:

tecadmin@ubuntubase:~/Desktop$ cd ../Downloads
tecadmin@ubuntubase:~/Downloads$ ls -l 
*
drwxr-xr-x  5 tecadmin  tecadmin  160 Jun 11 12:53 &lt;Your_Connection_Profile&gt;
*
</code></pre>
<p><strong>6.</strong> When you are there, enter this command to copy our connection
profile to our new digibank folder :</p>
<pre><code>tecadmin@ubuntubase:~/Downloads$ cp connectionprofile.json /home/tecadmin/Desktop/digibank/
</code></pre>
<p><strong>7.</strong> From here, go into VSCode and add the <code>digibank</code> folder to the
workplace. To do this, go to the Editor perspective and then right
click on the empty black space and select <code>Add Folder to Workspace</code>.
From there, go to your <code>digibank</code> folder and click on <code>select</code> to open
up the file.</p>
<p><strong>8.</strong> Once you have the <code>digibank</code> folder open, right click on your
connection profile file and select <code>Rename</code>. Then rename your connection
profile to <code>networkConnection.json</code>.</p>
<p><strong>9.</strong> Then toggle on the <code>Identity</code> folder within the <code>digibank</code>
folder. Within there, you will see 3 files: <code>config.json</code>, <code>enroll.js</code>
and then <code>package.json</code>. Within the <code>config.json</code> file, we have a few
places wanting some information. The <strong>only</strong> things we have to change
is our CA port number as well as our MSP name. Other than that, keep
everything the same! You can find your CA port by opening your
<code>networkConnection.json</code> file and looking for the IP address under the
<code>certificateAuthorities</code> section. It should have a <code>192.168.22.81:3xxx</code>
IP address. :</p>
<pre><code>{
  "connection_file": "/home/tecadmin/Desktop/digibank/networkConnection.json",
  "appAdmin": "app-admin",
  "appAdminSecret": "app-adminpw",
  "orgMSPID": "teamXXorg1msp",
  "caName": "https://192.168.22.81:&lt;Put_Your_CA_Port_Here&gt;",
  "userName": "app-admin",
  "gatewayDiscovery": {
    "enabled": true,
    "asLocalhost": false
  }
}

--- CHANGES TO ---

{
  "connection_file": "/home/tecadmin/Desktop/digibank/networkConnection.json",
  "appAdmin": "app-admin",
  "appAdminSecret": "app-adminpw",
  "orgMSPID": "team19org1msp",
  "caName": "https://192.168.22.81:31142",
  "userName": "app-admin",
  "gatewayDiscovery": {
    "enabled": true,
    "asLocalhost": false
  }
}
</code></pre>
<p><strong>Save this File!</strong></p>
<p><strong>10.</strong> Within the <code>digibank</code> folder there is a <code>src</code> folder. Within the
<code>src</code> there will be a <code>blockchainClient.ts</code> file. You can click on the
file to open it up and then navigate to <code>line 38</code>. Go ahead and rename
the channel to match the channel name in your IBM Blockchain for
Multicloud console. :</p>
<pre><code>const network = await gateway.getNetwork('teamXX-channel1');

--- CHANGES TO ---

const network = await gateway.getNetwork('team19-channel1');
</code></pre>
<p><strong>Save this File!</strong></p>
<p><strong>11.</strong> From the CLI application, navigate to the <code>digibank/Identity</code>
folder and then run the command below :</p>
<pre><code>tecadmin@ubuntubase:~/Downloads$ cd /home/tecadmin/Desktop/digibank/Identity
tecadmin@ubuntubase:~/Desktop/digibank/Identity$ npm install
*
*
</code></pre>
<p><strong>12.</strong> Once npm has completed some installations, run the command below
to enroll our user :</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank/Identity$ node enroll.js
Wallet path: /home/tecadmin/Desktop/digibank/IBP
msg: Successfully enrolled admin user app-admin and imported it into the wallet
</code></pre>
<p><strong>13.</strong> The previous step created a certificate and public/private key
pair for us. We can check that by entering the command below :</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank/Identity$ ls -l ../IBP
total 4
drwxr-xr-x 2 tecadmin tecadmin 4096 Jun 27 00:39 app-admin
tecadmin@ubuntubase:~/Desktop/digibank/Identity$ ls -l ../IBP/app-admin
total 12
-rw-r--r-- 1 tecadmin tecadmin  246 Jun 27 00:39 5b17e99aa4da28c2dad4d834409e01c543f19965840b3ba4482049111893897e-priv
-rw-r--r-- 1 tecadmin tecadmin  182 Jun 27 00:39 5b17e99aa4da28c2dad4d834409e01c543f19965840b3ba4482049111893897e-pub
-rw-r--r-- 1 tecadmin tecadmin 1104 Jun 27 00:39 app-admin
</code></pre>
<p><strong>14.</strong> Then change the Jenkinsfile to match your team :</p>
<p><img alt="image" src="../jenkinsimages/add_your_team_jenkinsfile.png" /></p>
<p><strong>15.</strong> Once npm has completed some installations, enter the next
command below to push our changes to our GitHub account :</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ git add *
tecadmin@ubuntubase:~/Desktop/digibank$ git commit -m 'blockchain is awesome' 
*
* Your file changes and other output messages
*
tecadmin@ubuntubase:~/Desktop/digibank$ git push
Counting objects: 53, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (48/48), done.
Writing objects: 100% (53/53), 13.95 KiB | 0 bytes/s, done.
Total 53 (delta 6), reused 0 (delta 0)
remote: Resolving deltas: 100% (6/6), done.
To github.com:austingrice/digibank.git
   140abdf..0666159  master -&gt; master
</code></pre>
<p><strong>16.</strong> Go back to your GitHub repository of <code>digibank</code> and then hit the
<code>refresh</code> button to confirm your changes took.</p>
<p><strong>JENKINS THEN GOES TO WORK FOR K8S LOOPBACKAPI</strong></p>
<p>Jenkins will enable us to automatically build a docker image from our code and deploy it into a IBM Cloud Private via Kubernetes. We are using the Kubernetes plugin for Jenkins to enable this functionality. Jenkins has functionality added through plugins to add new capabilities and features from a variety of different contributors. </p>
<p>One of these plugins enables us to connect to Jenkins via a Github webhook so that when new code is pushed it will automatically trigger your Jenkins jobs (in our case we will be using a pipeline).</p>
<p><strong>i</strong>. Go to the github fork where you just pushed new code. Then, go to the <code>settings</code> for the repository
<img alt="image" src="../jenkinsimages/choose_settings.png" /></p>
<p><strong>ii</strong> Choose the <code>Webhooks</code> section
<img alt="image" src="../jenkinsimages/Choose_Webhook.png" /></p>
<p><strong>iii</strong> Click to add your webhook.
<img alt="image" src="../jenkinsimages/add_webhook.png" /></p>
<p><strong>iv</strong> Configure your webhook.
<img alt="image" src="../jenkinsimages/Webhook_settings.png" /></p>
<pre><code>1. smee url: The smee url will be provided to you for the lab as it is auto-generated for each lab.
2. `application/json` content type
3. Leave the rest as defaults as shown and click `Add Webhook`
</code></pre>
<p>You may be wondering why we are providing a smee url here and not a jenkins url. Our Jenkins service is not accessible from the public internet. Thus, we can use smee, which is a service that serves as a proxy for webhooks. It acts as a local sidecar container to the Jenkins master (running in the same Kubernetes pod) on it's network. While the services such as GitHub on the public internet can't initaite connections with it, it can initiate connections with them. Using this method, smee forwards Jenkins webhooks when it hears of them via a connection to a public smee service (addressable from the internet) which is in turn listening for github webhooks from your github repositories. </p>
<p><strong>v</strong> See successful Webhook creation message.
<img alt="image" src="../jenkinsimages/success_message.png" /></p>
<p><strong>vi</strong> Time to go to Jenkins. Navigate to <code>https://192.168.22.81:8443/jenkins</code> in your browser.</p>
<p><strong>vii</strong> Upon seeing the welcome page please enter you team and password for the lab which will be given to you. In this case I am <code>team19</code>. 
<img alt="image" src="../jenkinsimages/jenkins_login.png" /></p>
<p><strong>viii</strong> After successfully logging in click on <code>My View</code> to see just the folder you have access to.
<img alt="image" src="../jenkinsimages/Jenkins_View.png" /></p>
<p><strong>ix</strong> Click on your folder (the only one listed) to enter it. 
<img alt="image" src="../jenkinsimages/select_workshop_name.png" /> </p>
<p><strong>x</strong> Create a new job. You could also have created a <code>New item</code> instead  which is why that is circled as well.
<img alt="image" src="../jenkinsimages/create_new_job.png" /></p>
<p><strong>xi</strong> Make a pipeline for your digibank project using the options shown below 
<img alt="image" src="../jenkinsimages/create_pipeline.png" /></p>
<p><strong>xii</strong> Get your repo url from your github fork.
<img alt="image" src="../jenkinsimages/get_repo_url.png" /></p>
<p><strong>xiii</strong> Use the url you got from the previous step for the github repository in the configuration below in both places it appears. The other values keep the same as mine. Click save when you are done entering these.
<img alt="image" src="../jenkinsimages/configure_pipeline.png" /></p>
<p><strong>xiv</strong> Set up authorization for your project in your personal folder by clicking on authorization.
<img alt="image" src="../jenkinsimages/authorization.png" /></p>
<p><strong>xv</strong>  Choose <code>Run as specific user</code> and put in your team name for the user. This will enable your github to run with your blessing.
<img alt="image" src="../jenkinsimages/use_teams_creds.png" /></p>
<p><strong>xvi</strong> Click the arrow next to your team name in the upper right hand corner to the left of log out and then select <code>Credentials</code>
<img alt="image" src="../jenkinsimages/add_creds.png" /></p>
<p><strong>xvii</strong> Click either the <code>Add Credentials</code> or <code>Adding some credentials?</code> link. 
<img alt="image" src="../jenkinsimages/make_user_creds.png" /></p>
<p><strong>xviii</strong> Make a credential id in Jenkins to securely access your icp creds by making an entry with your team name and password and an id of <code>teamname-icp</code> and click ok.
<img alt="image" src="../jenkinsimages/fillin_creds.png" /></p>
<p><strong>xix</strong> Go to <code>My View</code> by clicking the arrow to the left of Jenkins in the upper left hand corner and selecting <code>My View</code>.
<img alt="image" src="../jenkinsimages/MyView.png" /></p>
<p><strong>xx</strong> Go on the time clock to build your project now to the right of your pipeline. This will run the Jenkinsfile in your cloned version of the github you adjusted to use your team with the one line change. 
<img alt="images" src="../jenkinsimages/click_on_project.png" /></p>
<p><strong>xxi</strong> View the output of your job in the console by clicking the arrow to the right of <code>Build View</code> and Selecting the console output.
<img alt="image" src="../jenkinsimages/view_console.png" /></p>
<p><strong>xxii</strong> The job should complete successfully and give you a url you can right click to visit in a new tab.
<img alt="image" src="../jenkinsimages/success_and_url.png" /></p>
<p>Proceed with Step 17.</p>
<p><strong>17.</strong> Once we have our loopback application deployed in our IBM Cloud
Private cluster, go ahead and open it. Once you get to the homepage for
loopback, click on the <code>Explorer</code> link to view our controllers (which
will submit transactions for us).</p>
<p><img alt="image" src="../cicdimages/explorer.png" /></p>
<p><strong>18.</strong> Go ahead and toggle on the <code>IssueController</code> and then click on
<code>Try it Out</code> in the top right. Go ahead and enter the text below to
issue a new paper :</p>
<pre><code>{
  "issuer": "Digibank",
  "paperNumber": "0032",
  "issueDateTime": "2020-05-31",
  "maturityDateTime": "2020-11-30",
  "faceValue": "500",
  "paperRate": "0.02"
}
</code></pre>
<p><strong>19.</strong> Then click on the <code>Execute</code> button below. Then, let it spin
around for a moment, but it should come back with some type of response
in the response body. Sometimes, it might continuously spin. It will
eventually time out, but actually submit the paper and have it be
recorded in the IBM Blockchain Platform. You can confirm this by going
to your console and clicking on your channel and viewing the block
height and transactions. For the loopback, you can just let it time out
and then try to issue the same paper with a new <code>paperNumber</code> and it
should come back.</p>
<p><img alt="image" src="../cicdimages/issue.png" /></p>
<p><strong>20.</strong> Do a similar transaction for <code>Buy</code> once you click on
<code>Try it Out</code> in the top right :</p>
<pre><code>{
  "issuer": "Digibank",
  "paperNumber": "0032",
  "currentOwner": "Digibank",
  "newOwner": "MagnetoCorp",
  "price": "400",
  "purchaseDateTime": "2020-06-10"
}
</code></pre>
<p><img alt="image" src="../cicdimages/buy.png" /></p>
<p><strong>21.</strong> Do the same for the <code>Redeem</code> transaction once you click on
<code>Try it Out</code> in the top right :</p>
<pre><code>{
  "issuer": "Digibank",
  "paperNumber": "0032",
  "redeemingOwner": "MagnetoCorp",
  "redeemDateTime": "2020-11-30"
}
</code></pre>
<p><strong>22.</strong> All of these transactions are being recorded on the IBM
Blockchain Platform by going to your channel list and then viewing the
block height and list of transactions.</p>
<p><strong>UPDATE OUR GITHUB TO ADD GETPAPER AND LET JENKINS GO BACK TO WORK</strong></p>
<p><strong>xxiii</strong>  See the successful job in Jenkins is github triggered. To get back to the project you can click <code>Back to project</code>. When the build is finished you can also reload the same page you were on before and see that is was updated as a new docker image was created and deployed to Kubernetes.
![jenkinsimages/successful_build_github_triggered.png]</p>
<p><strong>1.</strong> Let's take advantage of our CI/CD pipeline, by adding our
<code>getAllPapersFromIssuer</code> query. <strong>Important:</strong> For this section, the
<code>getAllPapersFromIssuer</code> transaction is going to be referred as
<code>getPapers</code>. It's the same logic, but we had to rename it due to some
loopback issues.</p>
<p><strong>2.</strong> To add our <code>getPaper</code> transaction we need to add a model,
repository and controller. Make sure your are in the
<strong>Desktop/digibank</strong> folder. Also, it is very important that what you
see below is what you enter. Make sure you don't see dashes (<code>-</code>) in any
of the prompts. :</p>
<pre><code>--- Make the Getpapers Model ---

tecadmin@ubuntubase:~/Desktop/digibank$ cd /home/tecadmin/Desktop/digibank/ 
*
* I realize, that I'm cd-ing into a folder I'm already in, but it is to make sure everyone in the lab is in the right folder!
*
tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: Getpapers
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Model Getpapers will be created in src/models/getpapers.model.ts

Let's add a property to Getpapers
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? Yes
? Is it required?: No
? Default value [leave blank for none]:

Let's add another property to Getpapers
Enter an empty property name when done

? Enter the property name:
   create src/models/getpapers.model.ts
   update src/models/index.ts

Model Getpapers was created in src/models/

-- Create the Getpapers Repository ---

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository Getpapers
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
   create src/repositories/getpapers.repository.ts
   update src/repositories/index.ts

Repository GetpapersRepository was created in src/repositories/

--- Create the Getpapers Controller ---

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Getpapers
Controller Getpapers will be created in src/controllers/getpapers.controller.ts

? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Getpapers
? What is the name of your CRUD repository? GetpapersRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /getpapers
   create src/controllers/getpapers.controller.ts
   update src/controllers/index.ts

Controller Getpapers was created in src/controllers/
</code></pre>
<p><strong>3.</strong> Within VSCode, navigate to the <code>digibank/src/repository</code> folder.
You will see 6 files, with 4 of them being our repositories. Open the
<code>getpaper.repository.ts</code> file and make a change that I lay out below on
line 8 :</p>
<pre><code>typeof Getpapers.prototype.,

--- Change To ---

// typeof Getpapers.prototype.,
</code></pre>
<p>Save this file!</p>
<p><strong>4.</strong> Within our <code>digibank/src/controllers</code> folder, open the
<code>getpapers.controller.ts</code> file and delete all of the code within that
controller. Next, paste in the code below :</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Getpapers } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class GetpapersController {
  constructor() { }

 @post('/getpapers', {
   responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Getpapers } } },
      },
    },
  })
  async createGetpapers(@requestBody() requestBody: Getpapers): Promise&lt;Getpapers&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)

    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let getpapers = new Getpapers({ issuer: errString });
      return getpapers;
    }
    console.log('newtork obj: ')
    console.log(networkObj)

    let dataForGetpapers = {
      function: 'getAllPapersFromIssuer',
      issuer: requestBody.issuer,
      contract: networkObj.contract
    };

    var resultString = await blockchainClient.getpapers(dataForGetpapers);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    console.log(resultString);
    let result = JSON.parse(resultString);
    return result;
  }

}
</code></pre>
<p>Save this file!</p>
<p><strong>5.</strong> Now, that we have made some further changes to our digibank
folder, let's push it back up to GitHub :</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ cd /home/tecadmin/Desktop/digibank
*
* I realize, that I'm cd-ing into a folder I'm already in, but it is to make sure everyone in the lab is in the right folder!
*
tecadmin@ubuntubase:~/Desktop/digibank$ git add *
tecadmin@ubuntubase:~/Desktop/digibank$ git commit -m 'blockchain is awesome' 
*
* Your file changes and other output messages
*
tecadmin@ubuntubase:~/Desktop/digibank$ git push
Counting objects: 53, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (48/48), done.
Writing objects: 100% (53/53), 13.95 KiB | 0 bytes/s, done.
Total 53 (delta 6), reused 0 (delta 0)
remote: Resolving deltas: 100% (6/6), done.
To github.com:austingrice/digibank.git
   140abdf..0666159  master -&gt; master
</code></pre>
<p><strong>LET JENKINS GO TO WORK BY MAKING A K8S DEPLOYMENT</strong></p>
<p><strong>xxiv</strong> You can again click back to main project and see successfully running job.
<img alt="image" src="../jenkinsimages/see triggered job.png" /></p>
<p><strong>xxv</strong> We can also see how Jenkins keeps track of the jobs triggered by Github.
<img alt="image" src="../jenkinsimages/triggered_from_git.png" /></p>
<p><strong>xxvi</strong> We can also see our console output again selecting the screen from the picture in step <code>xxv</code> above this one. This console should show another successful job and we can now again visit the updated loopback.
<img alt="image" src="../jenkinsimages/see_it_Deploy_succcessfully.png" /></p>
<p><strong>6.</strong> Once you have your kubernetes deployment of our loopback
application, go ahead and open it. Then go to the <code>GetpapersController</code>
and then paste in the text below once you click on <code>Try it Out</code> :</p>
<pre><code>{
  "issuer": "Digibank"
}
</code></pre>
<p><img alt="image" src="../cicdimages/getpapers.png" /></p>
<p><strong>xxvii</strong> It's time to cleanup the Github webhook since you are done with it. Go back to your fork of Github repository for this lab. Go to the settings page for the repository and then Webhooks. Click delete to clean up the Webhook.
<img alt="image" src="../jenkinsimages/cleanup_webhooks.png" /></p>
<p><strong>xxvii</strong> Finally, get a message confirming your deletion and pat yourself on the back for a job well done, but of course don't forget our now familiar friend Jenkins.
<img alt="image" src="../jenkinsimages/all_clean.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ibpdeploy/" title="Part 2 - Deploy Smart Contract" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Part 2 - Deploy Smart Contract
              </span>
            </div>
          </a>
        
        
          <a href="../references/" title="Additional Resources" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Additional Resources
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>