
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../images/ibm_blockchain_platform.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.4">
    
    
      
        <title>Connect part1 - Blockchain Immersion Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.358818c7.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f0267088.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Blockchain Immersion Workshop" class="md-header-nav__button md-logo" aria-label="Blockchain Immersion Workshop">
      
  <img src="../images/ibm_blockchain_platform.ico" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Blockchain Immersion Workshop
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Connect part1
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Blockchain Immersion Workshop" class="md-nav__button md-logo" aria-label="Blockchain Immersion Workshop">
      
  <img src="../images/ibm_blockchain_platform.ico" alt="logo">

    </a>
    Blockchain Immersion Workshop
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Choose your own lab
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Choose your own lab" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Choose your own lab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-intro/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../assignment/" class="md-nav__link">
      Skytap image assignments
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Build your first network on Linux on IBM Z Lab
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Build your first network on Linux on IBM Z Lab" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Build your first network on Linux on IBM Z Lab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../console-urls/" class="md-nav__link">
      IBM Blockchain Platform Console URL assignments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpconsole/" class="md-nav__link">
      Part 1 - Create a Blockchain Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ibpdeploy/" class="md-nav__link">
      Part 2 - Deploy a Smart Contract
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../references/" class="md-nav__link">
      Additional Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-to-your-peer" class="md-nav__link">
    Connect to your peer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-to-our-kubernetes-cluster" class="md-nav__link">
    Login to our Kubernetes cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#take-a-look-at-your-peer-setup-environment-variables" class="md-nav__link">
    Take a look at your peer setup environment variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-the-chaincode-on-the-peer-and-the-channel" class="md-nav__link">
    Check the chaincode on the peer and the channel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-transactions-with-the-peer-to-create-yourself-as-a-marbles-owner-with-a-marble-of-your-own" class="md-nav__link">
    Submit transactions with the peer to create yourself as a marbles owner with a marble of your own
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-marbles-application-to-connect-to-your-peer" class="md-nav__link">
    Configure the marbles application to connect to your peer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-the-marbles-application-to-your-peer" class="md-nav__link">
    Connect the marbles application to your peer
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Connect part1</h1>
                
                <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The goal of this part of the lab is to go through the process of using your peer with the fabric command line interface (cli) tools and connecting it with marbles. </p>
<p>In this part of the lab, you will:</p>
<ol>
<li>Connect to your peer</li>
<li>Log in to our Kubernetes cluster</li>
<li>Take a look at your peer setup environment variables</li>
<li>Check the chaincode on the peer and the channel</li>
<li>Submit transactions with your peer to create yourself as a marbles owner with a marble</li>
<li>Configure the marbles application to connect to your peer</li>
<li>Connect the marbles application to your peer</li>
</ol>
<h2 id="connect-to-your-peer">Connect to your peer<a class="headerlink" href="#connect-to-your-peer" title="Permanent link">&para;</a></h2>
<p>An IBM Blockchain Platform network has been set up with an organization for each member of the lab in our IBM Cloud Private Kubernetes Cluster. The necessary certificate material and environment variables to operate your peer as well as the marbles project have been packaged into a container for your use during the lab.</p>
<p>This container is labeled based on your team.</p>
<p>Please open a terminal window on your computer, set your given ip address and ssh into that z machine</p>
<p><code>IP_ADDRESS=givenip</code></p>
<p><code>ssh bcuser@$IP_ADDRESS</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>Welcome to Ubuntu 16.04.5 LTS (GNU/Linux 4.4.0-139-generic s390x)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
Last login: Mon Jan 21 21:43:38 2019 from 192.168.22.64
bcuser@ubuntu16045:~
</code></pre></div></p>
<p>Then, add the cluster to your /etc/hosts and add the self-signed certificate to your ca-certificates (Note: Please run this command exactly as printed below keeping the <code>192.168.22.81</code> ip address which is the address to access our ICP Kubernetes cluster)</p>
<div class="highlight"><pre><span></span><code>echo &quot;192.168.22.81   wsc-ibp-icp-cluster.icp&quot; | sudo tee --append /etc/hosts &amp;&amp; sudo mkdir /usr/local/share/ca-certificates/wsc-ibp-icp-cluster.icp &amp;&amp; sudo openssl s_client -showcerts -servername wsc-ibp-icp-cluster.icp -connect wsc-ibp-icp-cluster.icp:8443 &lt;/dev/null 2&gt;/dev/null | sudo openssl x509 | sudo tee /usr/local/share/ca-certificates/wsc-ibp-icp-cluster.icp/ca.crt &amp;&amp; sudo update-ca-certificates
</code></pre></div>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>192.168.22.81   wsc-ibp-icp-cluster.icp
-----BEGIN CERTIFICATE-----
MIIFfjCCA2agAwIBAgIQbJlENedx5PvDbGD7XLDnITANBgkqhkiG9w0BAQsFADBj
MQswCQYDVQQGEwJVUzERMA8GA1UECAwITmV3IFlvcmsxDzANBgNVBAcMBkFybW9u
azEaMBgGA1UECgwRSUJNIENsb3VkIFByaXZhdGUxFDASBgNVBAMMC3d3dy5pYm0u
Y29tMCAXDTE4MTIxMjE5NTQ1MVoYDzIxMTgxMTE4MTk1NDUxWjBgMQswCQYDVQQG
EwJDTjEQMA4GA1UECAwHU2hhYW54aTEOMAwGA1UEBwwFWGknYW4xGjAYBgNVBAoM
EUlCTSBDbG91ZCBQcml2YXRlMRMwEQYDVQQDDAppY3Atcm91dGVyMIIBIjANBgkq
hkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArsBisMJEyMGHZ+93mcFsXX0AQc+QXSVW
o53f3JEd2Kn+tZLx57vOzRWmMop7B1pSe06c1GwFKofOWSTgHCHv8DO8+h9TIm3x
+9IUaLx65mxrTMToUjIxjNyt2JjElHJskxrbpwJsofG59gxhGal8ed89SveXYIL/
PkXvkm5jsoPaRFjgQq0KJoy9UO26aD/FMJu9HzV+7P6Tu8Q+OJHgWSvIgKfX9vOg
qyMxv8vGYEGh4jLgQFRMMfXdH01y2diZ259771wHjsTdMRUnxRC36RTDgIXp+0CR
143p1+dmucYD5G45rOwzPuDi67VNho8mtXs5ohTQfovj4FdcDVtFgQIDAQABo4IB
LTCCASkwCQYDVR0TBAIwADAdBgNVHQ4EFgQUIMoa55D0BPmJ5FYOEiIa6mw+qtYw
gZUGA1UdIwSBjTCBioAUZ9zE9CrhJ2Lm/tLiDLDK5H3asjqhZ6RlMGMxCzAJBgNV
BAYTAlVTMREwDwYDVQQIDAhOZXcgWW9yazEPMA0GA1UEBwwGQXJtb25rMRowGAYD
VQQKDBFJQk0gQ2xvdWQgUHJpdmF0ZTEUMBIGA1UEAwwLd3d3LmlibS5jb22CCQCV
Y/GaGOxNzTAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwCwYDVR0PBAQD
AgWgMDkGA1UdEQQyMDCHBH8AAAGCCWxvY2FsaG9zdIcEwKgWUYIXd3NjLWlicC1p
Y3AtY2x1c3Rlci5pY3AwDQYJKoZIhvcNAQELBQADggIBABCkUfS8TTO2sPJlJjAn
ZiatcrliKZ2KJqdNNouF68E+xHfthfXxhl93TP5oUEw7lFN8yRb+z0o16wZksliw
h8FpunHZAuQ+M2qI3afIiRU2H58drGHkBmbZwoMYAQaFrU+A9VEzgibtjBHCkL4p
g+3kzQySCJq+A9lmVq/gwrd3cqfPxsFckqq1eGvP8BfcwxvkUIPnOp/Vh9f2jgK7
UNfmPd4hZSzTr2jOfdBAGaltc4C+MAougCAppz7cVQXvb9A2b7ffF3JmYbr626Bk
Pp7c0rZAzLRsoZy8ngT9zS+9CucY8MolpPDQmBL48asaMYCRgTx6wAgD6bDzJnpt
F0c+FFf7k4782vJELs4gwXkkWRVmaHBlHn4yfYObsiS23snhu2Fvuu2bBWmFMXEr
PCK9d1JO1czb672fd18aOj6pmNLZMiIfwIxOxkDpASa4urOhA4sV/61cTpxCSuGs
MFhrLN9rKvPlQCh+z/gLPvcf/DVuKoRO+JIVLKl7oSp4GQY7HjdpzggUvCxayp3J
EUe4eqOnN50oogTFw8FA4/mNrMzt4wXfk/1yPgWS9ey0EBuFg8fTi2GjLuR00Xsb
pjbmU0n0RUpzWdZBHZwb2SpvA6D5M7Ii+aFM0eH5YK5gCU9U9x3hI1MjAtVsINsF
cTiYtc/9hu704vR7CQ3uFvOk
-----END CERTIFICATE-----
Updating certificates in /etc/ssl/certs...
1 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d...
done.
</code></pre></div>
Take particular note that 1 certificate was added and 0 removed in your output like in the sample output above.</p>
<p>Next, restart your docker service to pick up the newly added certificate:
<div class="highlight"><pre><span></span><code>sudo service docker restart
</code></pre></div></p>
<p>Next, login to the private docker repository:
<div class="highlight"><pre><span></span><code>echo $credential | docker login wsc-ibp-icp-cluster.icp:8500 -u $TEAM --password-stdin
</code></pre></div></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>Login Succeeded
</code></pre></div></p>
<p>Now, start your unique image which will return a command prompt:</p>
<div class="highlight"><pre><span></span><code>docker run --rm -it -v /var/run/docker.sock:/var/run/docker.sock --name $TEAM -p 3000:3001 wsc-ibp-icp-cluster.icp:8500/lab-test/connectathon-s390x-$TEAM:1.0 bash
</code></pre></div>
<p>This command is using Docker to run your team's container in an interactive bash shell and connect it to your machine's docker socket so you can create sibling containers from your container image. Additionally, you are giving it the name of your team and forwarding traffic on port 3000 of the host to port 3001 on your container to access your marbles application during the lab. This means marbles comes up on port 3000 in this part1 of the connectathon versus port 3001 in part2. This makes it so that no port conflicts occur during the lab.</p>
<h2 id="login-to-our-kubernetes-cluster">Login to our Kubernetes cluster<a class="headerlink" href="#login-to-our-kubernetes-cluster" title="Permanent link">&para;</a></h2>
<p>Run the following command to connect to the running IBM Cloud Private Kubernetes cluster.</p>
<p><code>cloudctl login -a https://192.168.22.81:8443 -u $team -p $credential -n lab-test</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>Targeted account wsc-ibp-icp-cluster Account (id-wsc-ibp-icp-cluster-account)

Targeted namespace lab-test

Configuring kubectl ...
Property &quot;clusters.wsc-ibp-icp-cluster&quot; unset.
Property &quot;users.wsc-ibp-icp-cluster-user&quot; unset.
Property &quot;contexts.wsc-ibp-icp-cluster-context&quot; unset.
Cluster &quot;wsc-ibp-icp-cluster&quot; set.
User &quot;wsc-ibp-icp-cluster-user&quot; set.
Context &quot;wsc-ibp-icp-cluster-context&quot; created.
Switched to context &quot;wsc-ibp-icp-cluster-context&quot;.
OK

Configuring helm: /root/.helm
OK
</code></pre></div></p>
<h2 id="take-a-look-at-your-peer-setup-environment-variables">Take a look at your peer setup environment variables<a class="headerlink" href="#take-a-look-at-your-peer-setup-environment-variables" title="Permanent link">&para;</a></h2>
<p>In order to operate your peer a number of environment variables need to be set. Let's take a look at some of the environment variables set for the Hyperledger Fabric cli to work with your peer:</p>
<p><code>env | grep "CORE\|FABRIC"</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>CORE_PEER_LOCALMSPID=org0
FABRIC_CFG_PATH=/home/fabric-ca-client/fabric-binaries/config
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/home/org0/admin
CORE_PEER_TLS_ROOTCERT_FILE=/home/org0/peertls.pem
CORE_PEER_ADDRESS=192.168.22.81:30787
</code></pre></div></p>
<p><code>CORE_PEER_LOCALMSPID</code> defines the local MSP or Membership Services Provider of the peer which contains the identifying information (i.e., certs and keys) for the peer as well as the certificates of trusted Certificate Authorities which are authorized to issue identities on behalf of the organization. (In the sample output above <code>org0</code> is the MSPID, yours will correspond with your team)</p>
<p><code>FABRIC_CFG_PATH=/home/fabric-ca-client/fabric-binaries/config</code> defines the config path that holds config files such as core.yaml required for some fabric binary tools such as the peer command used in <code>peer chaincode list --installed</code> below.</p>
<p><code>CORE_PEER_TLS_ENABLED=true</code> is used to enable transport layer security (TLS) communication.</p>
<p><code>CORE_PEER_MSPCONFIGPATH</code> points to the MSP material you are using to operate the peer</p>
<p><code>CORE_PEER_TLS_ROOTCERT_FILE</code> is the path to the root TLS certificate for the peer which your system needs to trust to have a TLS connection with the peer. </p>
<p><code>CORE_PEER_ADDRESS</code> is the peer's IP address used to connect with the peer. </p>
<p>Additionally, a few more variables are set for ease of use in later commands. You can see the values of these variables with the command below:</p>
<p><code>env | grep "CHANNEL\|CC_NAME\|ORDERER_CA\|ORDERER_1\|team\|credential" | grep -v "DOCKER"</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>ORDERER_1=192.168.22.81:30634
CC_NAME=marbles
CHANNEL=mychannel
team=team00
ORDERER_CA=/home/org0/ordererca.pem
credential=p@ssw0rd
</code></pre></div></p>
<p><code>ORDERER_1</code> is the orderer's IP address used to connect to the orderer.</p>
<p><code>CC_NAME</code> is the name of the chaincode that we are targeting on the channel.</p>
<p><code>CHANNEL</code> is the name of the channel we are targeting. Remember a channel in Hyperledger Fabric is it's own subnetwork of communication with its own ledger. </p>
<p><code>team</code> is the name of the team that you are a part of for this lab which is used to differentiate between different lab members.</p>
<p><code>ORDERER_CA</code> is the path to the root TLS certificate for the orderer which your system needs to trust to have a TLS connection with the orderer.</p>
<p><code>credential</code> is the password you will use to authenticate to the cluster for both the private docker registry as well as the Kubernetes API server. </p>
<h2 id="check-the-chaincode-on-the-peer-and-the-channel">Check the chaincode on the peer and the channel<a class="headerlink" href="#check-the-chaincode-on-the-peer-and-the-channel" title="Permanent link">&para;</a></h2>
<p>In order to check which chaincode is installed on your peer run:</p>
<p><code>peer chaincode list --installed</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>Get installed chaincodes on peer:
Name: marbles, Version: 1.0, Path: marbles, Id: 4421fd51a7949b08620ab8db7407d1269c38e4ef2edd143b1a78d56ae82eaa2d
</code></pre></div></p>
<p>You will notice the marbles chaincode has been installed on your peer.</p>
<p>Next, let's check which chaincode is instantiated on the channel:</p>
<p><code>peer chaincode list --instantiated -C $CHANNEL</code></p>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>Get instantiated chaincodes on channel mychannel:
Name: marbles, Version: 1.0, Path: marbles, Escc: escc, Vscc: vscc
</code></pre></div></p>
<p>Here, you see the marbles chaincode has also been instantiated on the channel and is ready to be used to submit transactions.</p>
<h2 id="submit-transactions-with-the-peer-to-create-yourself-as-a-marbles-owner-with-a-marble-of-your-own">Submit transactions with the peer to create yourself as a marbles owner with a marble of your own<a class="headerlink" href="#submit-transactions-with-the-peer-to-create-yourself-as-a-marbles-owner-with-a-marble-of-your-own" title="Permanent link">&para;</a></h2>
<p>Now it's time for one of your team members to add yourself as a marbles owner to the channel.</p>
<p>First set your name as the marbles owner</p>
<p><code>owner=Garrett</code></p>
<p>Then create the owner with the following command:</p>
<div class="highlight"><pre><span></span><code>peer chaincode invoke -C ${CHANNEL} -n ${CC_NAME} -c &#39;{&quot;Args&quot;:[&quot;init_owner&quot;,&quot;o0&#39;$team&#39;&quot;, &quot;&#39;$owner&#39;&quot;, &quot;&#39;$CORE_PEER_LOCALMSPID&#39;&quot;]}&#39; --tls --cafile $ORDERER_CA -o ${ORDERER_1}
</code></pre></div>
<p>Sample Output:
<div class="highlight"><pre><span></span><code>2019-03-08 03:47:55.093 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200
</code></pre></div></p>
<p>Next, give your owner a black marble:</p>
<div class="highlight"><pre><span></span><code>peer chaincode invoke -C ${CHANNEL} -n ${CC_NAME} -c &#39;{&quot;Args&quot;:[&quot;init_marble&quot;,&quot;m0&#39;$team&#39;&quot;,&quot;black&quot;,&quot;200&quot;,&quot;o0&#39;$team&#39;&quot;,&quot;&#39;$CORE_PEER_LOCALMSPID&#39;&quot;]}&#39; --tls --cafile $ORDERER_CA -o ${ORDERER_1}
</code></pre></div>
<p>Sample Output
<div class="highlight"><pre><span></span><code>2019-03-08 03:48:02.027 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200
</code></pre></div></p>
<p>Finally, run a query against the ledger to see your owner and marble as well as everyone else's so far:</p>
<p><div class="highlight"><pre><span></span><code>peer chaincode invoke -C ${CHANNEL} -n ${CC_NAME} -c &#39;{&quot;Args&quot;:[&quot;read_everything&quot;]}&#39; --tls --cafile $ORDERER_CA -o ${ORDERER_1}
</code></pre></div>
Sample Output:
<div class="highlight"><pre><span></span><code>2019-03-15 08:47:04.730 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 payload:&quot;{\&quot;owners\&quot;:[{\&quot;docType\&quot;:\&quot;marble_owner\&quot;,\&quot;id\&quot;:\&quot;o015525575491703BpSw\&quot;,\&quot;username\&quot;:\&quot;rick\&quot;,\&quot;company\&quot;:\&quot;org0\&quot;,\&quot;enabled\&quot;:true}
</code></pre></div>
Note: This will grow as more marbles and owners get added to the ledger by your org and other orgs.</p>
<h2 id="configure-the-marbles-application-to-connect-to-your-peer">Configure the marbles application to connect to your peer<a class="headerlink" href="#configure-the-marbles-application-to-connect-to-your-peer" title="Permanent link">&para;</a></h2>
<p>Go into the marbles directory: <code>cd marbles/config</code></p>
<p>The marbles application will connect to your fabric network using the Hyperledger Fabric Node.js Software Development Kit (SDK) Application Programming Interface (API) by consuming information in the file <code>connection_profile_tls.json</code></p>
<p>Take a look at this file with <code>cat connection_profile_tls.json</code></p>
<p>Take note that this file has connection information and TLS certificates for your, peers, certificate authority (CA), and the orderer for your network.</p>
<p>Next, you will be able to specify which users you want to enroll in your application. </p>
<p>Edit the file <code>marbles_tls.json</code> to do this:</p>
<p><code>vim marbles_tls.json</code></p>
<p>Edit the names to what you want in the usernames section such as:</p>
<div class="highlight"><pre><span></span><code>{
    &quot;cred_filename&quot;: &quot;connection_profile_tls.json&quot;,
    &quot;use_events&quot;: true,
    &quot;keep_alive_secs&quot;: 120,
    &quot;usernames&quot;: [
        &quot;Beth&quot;,
        &quot;Rick&quot;,
        &quot;Jerry&quot;
    ],
    &quot;port&quot;: 3001
}
</code></pre></div>
<p>In vim you edit by typing i and then making your changes using the arrow keys to navigate. Once you are finished making changes hit the escape key. Then save your changes with a save command such as <code>:x</code>, holding down shift and typing <code>ZZ</code> (<code>shift + ZZ</code>), <code>shift + ZQ</code> or using the worst option <code>:wq</code>.</p>
<p>Once the file has been saved, move back to the parent directory with <code>cd ..</code></p>
<h2 id="connect-the-marbles-application-to-your-peer">Connect the marbles application to your peer<a class="headerlink" href="#connect-the-marbles-application-to-your-peer" title="Permanent link">&para;</a></h2>
<p>Run <code>npm install -g gulp</code></p>
<p>This will install the gulp npm package necessary to run the marbles application. Warnings are to be expected and are normal at this step and the following <code>npm install</code> step.</p>
<p>Run <code>npm install</code></p>
<p>This will install the dependencies for the marbles application specified in the package.json file in the <code>/home/marbles</code> directory. This may take a few minutes. You will notice a bunch of <code>CXX(target)</code> in the output of this command because two of the packages (i.e., pkcs11js and grpc) need to be compiled from source for s390x. This needs to happen since the binaries are not publicly available for this platform. When this command completes it will return your terminal to you.</p>
<p>Now you can start the marbles application with <code>gulp marbles_tls</code></p>
<p>Open up a web browser on your pc and navigate to the ip given to you earlier at port 3000 in the form <code>xxx.xxx.xxx.xxx:3000</code> where <code>xxx.xxx.xxx.xxx</code> is your given ip address with each x being a possible digit (e.g., <code>192.168.22.150:3000</code>).</p>
<p>First, choose Express to setup your marbles application</p>
<p><img alt="Express Option" src="../images/ExpressOption.png" /></p>
<p>Here you can see your org's owners and marbles. You created the owner with your name and a black marble to its name with the cli commands at the beginning of this part of the lab. You created the other three owners by specifying the parameters in the <code>marbles_tls.json</code> file. If you are wondering about marble colors you created a black marble with the cli and the application randomly selected a color for the marbles created from the marbles_tls.json file (in my case black, but your mileage with the random function may vary)</p>
<p><img alt="Marbles UI Org Picture" src="../images/OrgUIPicture.png" /></p>
<p>We can also see the other orgs and their marbles that are connected in this connectathon.</p>
<p>Next, turn on story mode to see the marble transaction process:</p>
<ol>
<li>Click on settings
<img alt="Settings picture" src="../images/Settings.png" /></li>
<li>Enable Story Mode
<img alt="Enable Story Mode pictures" src="../images/StoryMode.png" /></li>
</ol>
<p>Finally, trade some marbles to other users. </p>
<ol>
<li>Click on a marble from a user in your org and drag it to another user in your org</li>
<li>Click and drag a marble from a member in your org and move it to a member of a different org</li>
<li>Click and drag a marble from a member of a different org and drag it to a member of your org</li>
</ol>
<p>Notice that you can give marbles to other orgs but can't take them. Please think about the logic for why this may be the case for this use case...</p>
<p>Now close the application by returning to your terminal and typing <code>ctrl + c</code> to get back your terminal prompt.</p>
<p>You have now setup the marbles application.</p>
<p>Please move on to part 2 where you will deploy this into our Kubernetes cluster.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>